<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="Requêtes avancées avec ElasticSearch" />

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <script src="javascripts/main.js"></script>
    
    <title>Requêtes avancées avec ElasticSearch</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <h1 id="project_title">Requêtes avancées avec ElasticSearch</h1>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <section>
    <h2>1 Préparation de votre environnement </h2>
    <p>Pour réaliser les différentes étapes de ce hands-on, vous avez besoin d'un elasticsearch. Plusieurs choix s'offre
        à vous :
        <li><strong>Choix numéro 1 : Utiliser Elasticsearch via Docker :</strong>
    <p>
        <code>docker run -p 9200:9200 -p 5601:5601 ibeauvais/elasticsearch-kibana</code>
    </p>
    <p>
        Vous pouvez ensuite accéder à elasticsearch sur <a href="http://localhost:9200/">http://localhost:9200/</a> et
        sense sur <a href="http://localhost:5601/app/sense">http://localhost:5601/app/sense</a>
        <br/>(si vous utilisez docker sur une vm ou via docker-machine remplacer localhost par l'ip de la vm)
    </p>
    </li>
    <li><strong>Choix numéro 2 : Utiliser l'Elasticsearch mis à votre disposition (partagé par tout le monde)</strong>
        <p>Vous pouvez ensuite accéder à elasticsearch sur <a href="http://ip:9200/">http://ip:9200/</a> et sense sur <a
                href="http://ip:5601/app/sense">http://ip:5601/app/sense</a><br/>
            Comme cet elasticsearch est utilisé par plusieurs personnes, veuillez préfixer le nom de vos indexes par
            votre nom lors des différentes requêtes de l'exercice.<br/>
            Exemple : Au lieu de faire GET http://ip:9200/myIndex/_search, je fais GET
            http://ip:9200/beauvais-myIndex/_search
        </p>
    </li>
    </p>
    <br/>
    <p>
        Pour effectuer des requêtes, vous allez utiliser l'api REST pour cela plusieurs choix également :
    <li><strong>Utiliser sense </strong>: application kibana avec auto-complétion et formatage des requêtes</li>
    <li><strong>Utiliser cUrl </strong></li>
    <li><strong>le client http de votre choix </strong></li>
    </p>

</section>
<section>
    <h2>2 Découverte de l'api</h2>
    <p>
    <li><strong>Premier document indexé :</strong></li>
    Requête <strong>POST</strong> {indexName}/{indexType}/{id}<figure class="highlight"><pre><code class="language-json" data-lang="json"><span class="w">    </span><span class="p">{</span><span class="w">
    </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Lovelace"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"firstname"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Ada"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"birthday"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"1815-12-10"</span><span class="w">
    </span><span class="p">}</span></code></pre></figure></p>
    <p>
    <li><strong>Retrouver le document par son id :</strong></li>
    Requête GET {indexName}/{indexType}/{id}</p>
    <p>
    <li><strong>Indexer d'autres documents :</strong></li>
    <figure class="highlight"><pre><code class="language-json" data-lang="json"><span class="w">    </span><span class="p">{</span><span class="w">
    </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Gosling"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"firstname"</span><span class="p">:</span><span class="w"> </span><span class="s2">"James"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"birthday"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"1954-05-19"</span><span class="w">
    </span><span class="p">}</span></code></pre></figure> <br/>
    <figure class="highlight"><pre><code class="language-json" data-lang="json"><span class="w">    </span><span class="p">{</span><span class="w">
    </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Ritchie"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"firstname"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Dennis"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"birthday"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"1941-09-09"</span><span class="w">
    </span><span class="p">}</span></code></pre></figure>
    </p>
    <p>
    <li><strong>Recherche sans critère :</strong></li>
    Requête <strong>GET</strong> {indexName}/{indexType}/_search

    <p>
    <li><strong>Recherche full text :</strong></li>
    Requête <strong>GET</strong> {indexName}/{indexType}/_search
    <figure class="highlight"><pre><code class="language-json" data-lang="json"><span class="w">    </span><span class="p">{</span><span class="w">
    </span><span class="nt">"query"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"match"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"gosling"</span><span class="w">
    </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span></code></pre></figure>
    <p>
    <li><strong>Voir le mapping :</strong></li>
    Requête <strong>GET</strong> {indexName}/{indexType}/_mapping
    </p>
    <p>
    <li><strong>Supprimer un document :</strong></li>
    Requête <strong>DELETE</strong> {indexName}/{indexType}/{id}
    </p>
    <li><strong>Supprimer l'index :</strong></li>
    Requête <strong>DELETE</strong> {indexName}
    </p>
</section>
<section>
    <h2>3 Recherche d'article de blog</h2>
    <p>Vous disposez un jeux de donnée à indexer dans elasticsearch contenant les articles du blog de Xebia. Vous allez
        dévoir réaliser plusieurs étapes afin d'implémenter la recherche de ces articles. Un document réprésente un
        article avec les champs suivants :
    <li><strong>title</strong> : le titre de l'article</li>
    <li><strong>pubDate</strong> : La date de publication de l'article</li>
    <li><strong>creator</strong> : L'auteur de l'article</li>
    <li><strong>category</strong> : L'article appartient à une ou plusieurs catégories</li>
    <li><strong>category</strong> : L'article appartient à une ou plusieurs catégories</li>
    <li><strong>description</strong> : Description courte de l'article</li>
    <li><strong>content</strong> : Contenu complet de l'article au format html</li>
    <br/>
    Pour indexer tous ces documents en une étape il faut utiliser curl :<br/>
    - Télécharger le dataset <a href="data/xebiablog.data">xebiablog.data</a><br/>
    - Exécuter une requête bulk indexing :<br/>
    <strong>curl -XPUT "http://{host}:9200/{indexName}/blog/_bulk" --data-binary @xebiablog.data</strong>

    </p>
    <p>
    <strong> Début de l'exercice : </strong>
    <li><strong>Vérifier que les documents sont correctements indexés :</strong></li>
    Requête <strong>GET</strong> {indexName}/blog/_count

    </p>
    <p>
</section>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">Requêtes avancées avec ElasticSearch par <a href="http://www.xebia.fr">Xebia</a></p>
        <p>Publié avec <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>
  </body>
</html>
